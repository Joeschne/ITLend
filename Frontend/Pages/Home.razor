@page "/"
@using Frontend.Components


<div class="container mt-4">
    <!-- Number of Available Laptops -->
    <div class="d-flex justify-content-between mb-4">
        <h1>Landing Page</h1>
        <div>
            <strong>Available Laptops:</strong> @availableLaptops
        </div>
    </div>

       <!-- Search Form -->
    <div class="mb-4">
        <h5>Search for a Student</h5>
        <div class="d-flex">
            <input type="text"
                   class="form-control me-2"
                   placeholder="Enter username..."
                   @bind="searchQuery"
                   @oninput="SearchStudentsAsync" />
            <button class="btn btn-primary" @onclick="OpenNewStudentModal">New</button>
        </div>
        @if (autocompleteResults.Any())
        {
            <ul class="list-group mt-2">
                @foreach (var student in autocompleteResults)
                {
                    <li class="list-group-item"
                        @onclick="() => SelectStudent(student)">
                        @student.Username
                    </li>
                }
            </ul>
        }
    </div>

    <!-- Bootstrap Alert -->
    @if (showNoLaptopsAlert)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            There are no available laptops.
            <button type="button" class="btn-close" @onclick="DismissNoLaptopsAlert" aria-label="Close"></button>
        </div>
    }

    <!-- Student Modal -->
    <StudentBookingsModal IsVisible="@showStudentModal"
                          StudentDetail="@selectedStudent"
                          ShowNewLendingButton="true"
                          OnClose="CloseStudentModal"
                          OnNewLending="OpenNewLendingModal" />

    <!-- New Lending Modal -->
    <NewLendingModal IsVisible="@showNewLendingModal"
                     NewBooking="@newBooking"
                     OnClose="CloseNewLendingModal"
                     OnSave="SaveNewBooking"
                     AvailableLaptops="@availableLaptopList" />




    <!-- Open Bookings -->
    <div>
        <h5>Open Bookings</h5>
        @if (openBookings == null)
        {
            <div class="alert alert-info">Loading open bookings...</div>
        }
        else if (!openBookings.Any())
        {
            <div class="alert alert-warning">No open bookings found.</div>
        }
        else
        {
            <div class="row">
                @foreach (var booking in openBookings)
                {
                    <div class="col-md-4 mb-3">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">Student: @booking.StudentUsername</h5>
                                <h6 class="card-subtitle mb-2 text-muted">
                                    @(string.IsNullOrEmpty(booking.TeacherEmail) ? "Returned by Student" : $"Returned by: {booking.TeacherEmail}")
                                </h6>
                                <p class="card-text">
                                    <strong>Laptop:</strong> @booking.Laptop.IdentificationNumber<br />
                                    <strong>Booking Date:</strong> @booking.BookingDateTime.ToString("g")<br />
                                    <strong>Planned Return:</strong> @booking.PlannedReturn.ToString("g")<br />
                                    <strong>Comment:</strong> @booking.Comment
                                </p>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
    </div>

</div>
